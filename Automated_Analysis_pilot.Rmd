---
title: "Sub 5 analysis"
author: "Dan Feeney"
date: "February 6, 2019"
output: html_document
---

```{r}
library(readxl)
rm(list=ls())

s5 <- read.csv("C:/Users/Daniel.Feeney/Dropbox (Boa)/2018 BOA Nonlinear Segment Performance/Analysis/AllSubResults.csv")
names(s5)[1]<-"Subject"

#load bootstrapping package, create functions to calcualte the metrics with a resample
library(boot)
library(ggplot2)
sampleMean <- function(x, d) {
  return(mean(x[d]))
}

conInterval_simple <- function(x){
  err <- qt(0.975, df=length(x) - 1) * sd(x)/sqrt(length(x))
  return(err)
}

set.seed(5280)
```

## Bootstrap the differences somewhat generic function. One for each comparison
```{r}
confidenceDifferences_m <- function(df, metric, num_boots) {
  C1_ap <- subset(df[,metric], df$Condition == 'M' & df$Movement == 'Skater')
  LC_ap <- subset(df[,metric], df$Condition == 'S' & df$Movement == 'Skater')

  mean_differences <- vector('numeric', 10000)

  for (i in 1:10000) {
    C1_tmp <- sample(C1_ap, length(C1_ap), replace=TRUE)
    LC_tmp <- sample(LC_ap, length(C1_ap), replace=TRUE)
    mean_differences[i] <- mean(C1_tmp - LC_tmp)
  }


  foo <- quantile(mean_differences,probs=c(0.125,0.875))
  bar <- quantile(mean_differences,probs=c(0.05, 0.95))

  newList <- list("low" = foo, "high" = bar)
  return(newList)
}

confidenceDifferences_l <- function(df, metric, num_boots) {
  C1_ap <- subset(df[,metric], df$Condition == 'L' & df$Movement == 'Skater')
  LC_ap <- subset(df[,metric], df$Condition == 'S' & df$Movement == 'Skater')

  mean_differences <- vector('numeric', 10000)

  for (i in 1:10000) {
    C1_tmp <- sample(C1_ap, length(C1_ap), replace=TRUE)
    LC_tmp <- sample(LC_ap, length(C1_ap), replace=TRUE)
    mean_differences[i] <- mean(C1_tmp - LC_tmp)
  }

  foo <- quantile(mean_differences,probs=c(0.125,0.875))
  bar <- quantile(mean_differences,probs=c(0.05, 0.95))

  newList <- list("low" = foo, "high" = bar)
  return(newList)
}

confidenceDifferences_t <- function(df, metric, num_boots) {
  C1_ap <- subset(df[,metric], df$Condition == 'T' & df$Movement == 'Skater')
  LC_ap <- subset(df[,metric], df$Condition == 'S' & df$Movement == 'Skater')

  mean_differences <- vector('numeric', 10000)

  for (i in 1:10000) {
    C1_tmp <- sample(C1_ap, length(C1_ap), replace=TRUE)
    LC_tmp <- sample(LC_ap, length(C1_ap), replace=TRUE)
    mean_differences[i] <- mean(C1_tmp - LC_tmp)
  }


  foo <- quantile(mean_differences,probs=c(0.125,0.875))
  bar <- quantile(mean_differences,probs=c(0.05, 0.95))

  newList <- list("low" = foo, "high" = bar)
  return(newList)
}

calc_Category <- function(dat){

  valStart <- 0
  
  if (dat$high[1] < 0 && dat$high[2] < 0) {
    valStart = 2
  } else if (dat$low[1] < 0 && dat$low[2] < 0) {
    valStart = 1
  } else if (dat$low[1] > 0 && dat$low[2] > 0) {
    valStart = -1
  } else if (dat$high[1] > 0 && dat$high[2] > 0) {
    valStart = -2
  } 
  
  return(valStart)
}


```


# Test Time on FP. Positive differences indicate longer time on plate for a config compared with laces.
## Lets start by looking at averages for each condition for Skater and CMJ
```{r}
skate <- subset(s5, s5$Movement == 'Skater')

```

## For Skater jumps
### A difference with a negative magnitude is good, a positive is bad
```{r}
depVar <- 'TimeonFP'
no_Subs <- length(unique(skate$Subject))

mCategorical_score <- numeric(length(unique(skate$Subject)))
lCategorical_score <- numeric(length(unique(skate$Subject)))
tCategorical_score <- numeric(length(unique(skate$Subject)))


count_var <- 1
for (subNo in unique(skate$Subject)) {
  
  tmp_sub <- subset(skate, skate$Subject == subNo)
  
  mVals <- confidenceDifferences_m(tmp_sub, 6, 10000)
  lVals <- confidenceDifferences_l(tmp_sub, 6, 10000)
  tVals <- confidenceDifferences_t(tmp_sub, 6, 10000)
  
  mCategorical_score[count_var] <- calc_Category(mVals)
  lCategorical_score[count_var] <- calc_Category(lVals)
  tCategorical_score[count_var] <- calc_Category(tVals)
  
  count_var <- count_var + 1
  
}

results <- as.data.frame(cbind(lCategorical_score, mCategorical_score, tCategorical_score, unique(skate$Subject), rep(depVar, no_Subs)))

names(results) <- c('L','M','T','Subject','Var')

```


# Test total GRF RFD avg eccentric. Negative differences indicate lower RFD average for a config compared with laces
## Lets start by looking at averages for each condition for Skater and CMJ
```{r}
tapply(skate$Total.GRF.RFD.Avg.Eccentric, skate$Condition, FUN = mean)

RFD_avg <- ggplot(skate, aes(x = Condition, y = abs(Total.GRF.RFD.Avg.Eccentric))) + geom_bar(stat='summary', fun.y='mean') +
    geom_pointrange(stat = "summary", fun.data = "mean_se",
                  position = position_dodge(width = 0.9)) 
RFD_avg +   theme(axis.text=element_text(size=12),
                  axis.title=element_text(size=14,face="bold")) + labs(title="Sub 5",x="Configuration", y = "Avg RFD Eccentric")
```


```{r}
confidenceDifferences_m(s5, 7, 10000)
confidenceDifferences_l(s5, 7, 10000)
confidenceDifferences_t(s5, 7, 10000)

```


# Test total GRF peak
## Lets start by looking at averages for each condition for Skater and CMJ
```{r}
tapply(skate$Total.GRF.Peak, skate$Condition, FUN = mean)

GRF_peak <- ggplot(skate, aes(x = Condition, y = abs(Total.GRF.Peak))) + geom_bar(stat='summary', fun.y='mean') +
    geom_pointrange(stat = "summary", fun.data = "mean_se",
                  position = position_dodge(width = 0.9)) 
GRF_peak +   theme(axis.text=element_text(size=12),
                  axis.title=element_text(size=14,face="bold")) + labs(title="Sub 5",x="Configuration", y = "Peak GRF")
```


```{r}
confidenceDifferences_m(s5, 8, 10000)
confidenceDifferences_l(s5, 8, 10000)
confidenceDifferences_t(s5, 8, 10000)

```


# Test COM peak power propulsive. Negative means lower peak power than laced
## Lets start by looking at averages for each condition for Skater and CMJ
```{r}
tapply(skate$COM.Power.Peak.Propulsive, skate$Condition, FUN = mean)

Pwr_peak <- ggplot(skate, aes(x = Condition, y = abs(COM.Power.Peak.Propulsive))) + geom_bar(stat='summary', fun.y='mean') +
    geom_pointrange(stat = "summary", fun.data = "mean_se",
                  position = position_dodge(width = 0.9)) 
Pwr_peak +   theme(axis.text=element_text(size=12),
                  axis.title=element_text(size=14,face="bold")) + labs(title="Sub 5",x="Configuration", y = "Peak COM Power Propulsive")
```


```{r}
confidenceDifferences_m(s5, 9, 1000)
confidenceDifferences_l(s5, 9, 1000)
confidenceDifferences_t(s5, 9, 1000)

```

# Test COM work eccentric. Values are negative. Positive difference means less COM work compared with laced (+)
## Lets start by looking at averages for each condition for Skater and CMJ
```{r}
tapply(skate$COM.Work.Eccentric, skate$Condition, FUN = mean)

Work_ecc <- ggplot(skate, aes(x = Condition, y = abs(COM.Work.Eccentric))) + geom_bar(stat='summary', fun.y='mean') +
    geom_pointrange(stat = "summary", fun.data = "mean_se",
                  position = position_dodge(width = 0.9)) 
Work_ecc +   theme(axis.text=element_text(size=12),
                  axis.title=element_text(size=14,face="bold")) + labs(title="Sub 5",x="Configuration", y = "COM Work Eccentric")
```


```{r}
confidenceDifferences_m(s5, 10, 1000)
confidenceDifferences_l(s5, 10, 1000)
confidenceDifferences_t(s5, 10, 1000)

```

# Test COM work propulsive. Negative means less COM work compared with laced. (+)
## Lets start by looking at averages for each condition for Skater and CMJ
```{r}
tapply(skate$COM.Work.Propulsive, skate$Condition, FUN = mean)

Work_prop <- ggplot(skate, aes(x = Condition, y = abs(COM.Work.Propulsive))) + geom_bar(stat='summary', fun.y='mean') +
    geom_pointrange(stat = "summary", fun.data = "mean_se",
                  position = position_dodge(width = 0.9)) 
Work_prop +   theme(axis.text=element_text(size=12),
                  axis.title=element_text(size=14,face="bold")) + labs(title="Sub 5",x="Configuration", y = "COM Work Propulsive")
```


```{r}
confidenceDifferences_m(s5, 11, 1000)
confidenceDifferences_l(s5, 11, 1000)
confidenceDifferences_t(s5, 11, 1000)

```